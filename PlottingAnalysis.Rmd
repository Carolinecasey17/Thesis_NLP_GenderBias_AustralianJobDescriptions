---
title: "Bias Plotting & Analysis"
output: html_notebook
---

```{r}
# setwd 
setwd('C:/Users/kilda/OneDrive/THESIS/Scripts')

sessionInfo()
```
```{r}
#install.packages("installr")
#library("installr")
#installr::updateR()

```


```{r}
#remove.packages("cli")
#install.packages("cli")

library(dplyr)
library(devtools)

#require(devtools)
#install_version("tidyverse", version = "1.1.1", repos = "http://cran.us.r-project.org ")

library(tidyverse)
library(stringr)
library(data.table)
library(ggplot2)
library(RColorBrewer)
library(readr)

#devtools::install_github('cttobin/ggthemr')
library(ggthemr)


```

```{r}
data_bias <- read_csv("dataset_final_google.csv")

#data_bias1 <- read_csv("dataset_final_merged2.csv")

#data_gd_glove <- read_csv("gender_bias_dict_glove.csv")
```

```{r}

data_gd_google <- read_csv("gender_bias_dict_google.csv") 
newdata <- data_gd_google[ which(data_gd_google$Bias > '-1000'), ]
length(newdata$Bias)

```
```{r}

newdata1 <- data_gd_google %>% filter(data_gd_google$Bias > '-1000.0000000')

```



```{r}
data_gd_glove <- read_csv("gender_bias_dict_glove.csv")

newdata <- data_gd_glove[ which(data_gd_glove$Bias > '-1000'), ]

length(newdata$Bias)

```


```{r}
## gender dictionary after merging extra data in 

data_gd_merged <- read_csv("gender_bias_dict_merged2.csv")
newdata3 <- data_gd_merged[ which(data_gd_merged$Bias > '-1000'), ]
length(newdata3$Bias)

```
^^ not sure if it's worth doing this, discuss 


```{r}
## gender bias dictionary - unique words with values before preprocessing was fixed 

data_gd_og <- read_csv("gender_bias_dict.csv") 
newdata4 <- data_gd_og[ which(data_gd_og$Bias > '-1000'), ]
length(newdata4$Bias)

```

```{r}
# gender bias dictionary using wikipedia pretrain (but all industries become positive) -- wtf? 

data_gd_wiki <- read_csv("gender_bias_dict_wiki.csv") 
newdata5 <- data_gd_wiki[ which(data_gd_wiki$Bias > '-1000'), ]
length(newdata5$Bias)


```


```{r}
# gender bias dictionary common crawl model/pretrain - also all positive 

data_gd_crawl <- read_csv("gender_bias_dict_crawl.csv") 

newdata6 <- data_gd_crawl[ which(data_gd_crawl$Bias > '-1000'), ]

length(newdata6$Bias)

```

```{r}


```



## ------ Density Plots ------ ##
```{r}
  
ggplot(data=data_bias, aes(data_bias$man_woman)) + 
  geom_histogram(aes(y =..density..),col="red", fill="green", alpha=.2) + 
  geom_density(col=2) + 
   labs(title="Density Plot of Gender Bias", y = "Density", x = "Gender Bias")
  


```
```{r}

summary(data_bias$man_woman)

```
```{r}
sd(data_bias$man_woman)
```
```{r}

sample <- data_bias[sample(nrow(data_bias), 5000), ]

shapiro.test(sample$man_woman)

```



### --- Top Words Male vs. Female --- ### 
Female encoded words - 

mothers	-0.250502959
women	-0.242072433
pregnant	-0.235946476
pregnancy	-0.233661883
lesbian	-0.223894194
breastfeeding	-0.223523491
bras	-0.220144995
feminine	-0.213751659
actresses	-0.212869629
gender	-0.201855466
lingerie	-0.200355515
babies	-0.193956211
nurse	-0.18663305
swimwear	-0.186498873
implants	-0.181541555

male endcoded words - 
wizard	0.218160905
beard	0.196113512
kingpin	0.191584907
buddy	0.188891947
guys	0.186992384
legend	0.177719891
tinkering	0.166542657
whiz	0.164664887
runout	0.157976776
mates	0.157605164
skipper	0.153876863
marshalling	0.153284557
orchestrator	0.153016772
scouting	0.151209559
wingman	0.150607549



```{r}
#testing old data 

df <- read_csv("DF_INDEED_CLEAN_BIAS1.csv")

lm_occu <- lm(man_woman ~ Sector, df)
summary(lm_occu)


```



## ------ Linear Regression Models ----- ## 
```{r}
lm_occu <- lm(man_woman ~ Occupation, data_bias)
summary(lm_occu)
```
```{r}
lm_ind <- lm(man_woman ~ Industry, data_bias)
summary(lm_ind)
```

```{r}
###------ dividing data into female and male bias + transforming female to absolute values to compare means   -----####


data_bias$mf[data_bias$man_woman <= 0] <- "female"
data_bias$mf[data_bias$man_woman >= 0] <- "male"
data_bias$biases <- "male"
data_bias$biases[data_bias$Industry == "Healthcare & Social Assistance" | data_bias$Industry == "Education & Training"] <- "female"
data_bias$absolute <- abs(data_bias$man_woman)
mean(data_bias$absolute[data_bias$mf == "female"])
mean(data_bias$absolute[data_bias$mf == "male"])
sd(data_bias$absolute[data_bias$mf == "female"])
sd(data_bias$absolute[data_bias$mf == "male"])
data.summary <- data_bias %>%
  group_by(mf) %>%
  summarise(
    sd = sd(absolute, na.rm = TRUE),
    len = mean(absolute)
  )
data.summary

ggplot(data.summary, aes(x = mf, y = len, ymin = len-sd, ymax = len+sd))+
  geom_errorbar(width = 0.2)

```

```{r}

t.test(data_bias$absolute[data_bias$mf == "male"], data_bias$absolute[data_bias$mf == "female"])
```


```{r}

in1 <- subset(data_bias, data_bias$Industry == 'Accommodation and Food Services')
summary(in1$man_woman)
write.csv(in1,"accomfs.csv") 

in22 <- subset(data_bias, data_bias$Industry == 'Administrative and Support Services')
summary(in22$man_woman)
write.csv(in22,"admin.csv") 

in2 <- subset(data_bias, data_bias$Industry == 'Agriculture Forestry and Fishing')
summary(in2$man_woman)
write.csv(in2,"agr.csv") 

in3 <- subset(data_bias, data_bias$Industry == 'Arts and Recreation Services')
summary(in3$man_woman)
write.csv(in3,"arts.csv") 

in4 <- subset(data_bias, data_bias$Industry == 'Construction')
summary(in4$man_woman)
write.csv(in4,"con.csv") 

in5 <- subset(data_bias, data_bias$Industry == 'Education and Training')
summary(in5$man_woman)
write.csv(in5,"edu.csv") 

in6 <- subset(data_bias, data_bias$Industry == 'Electricity Gas Water and Waste Services')
summary(in6$man_woman)
write.csv(in6,"ele.csv") 

in7 <- subset(data_bias, data_bias$Industry == 'Financial and Insurance Services')
summary(in7$man_woman)
write.csv(in7,"fin.csv") 

in8 <- subset(data_bias, data_bias$Industry == 'Healthcare and Social Assistance')
summary(in8$man_woman)
write.csv(in8,"health.csv") 

in9 <- subset(data_bias, data_bias$Industry == 'Information Media and Telecommunications')
summary(in9$man_woman)
write.csv(in9,"info.csv") 

in10 <- subset(data_bias, data_bias$Industry == 'Manufacturing')
summary(in10$man_woman)
write.csv(in10,"manu.csv") 

in11 <- subset(data_bias, data_bias$Industry == 'Mining')
summary(in11$man_woman)
write.csv(in11,"mining.csv") 

in12 <- subset(data_bias, data_bias$Industry == 'Professional Scientific and Technical Services')
summary(in12$man_woman)
write.csv(in12,"prof.csv") 

in13 <- subset(data_bias, data_bias$Industry == 'Public Administration and Safety')
summary(in13$man_woman)
write.csv(in13,"public.csv") 

in14 <- subset(data_bias, data_bias$Industry == 'Rental Hiring and Real Estate Services')
summary(in14$man_woman)
write.csv(in14,"rental.csv") 

in15 <- subset(data_bias, data_bias$Industry == 'Retail Trade')
summary(in15$man_woman)
write.csv(in15,"retail.csv") 

in16 <- subset(data_bias, data_bias$Industry == 'Transport Postal and Warehousing')
summary(in16$man_woman)
write.csv(in16,"trans.csv") 

in17 <- subset(data_bias, data_bias$Industry == 'Wholesale Trade')
summary(in17$man_woman)
write.csv(in17,"wholesale.csv") 

```

```{r}

r1 <- subset(data_bias, data_bias$Rating == 'Accommodation and Food Services')
summary(in1$Rating)

r2 <- subset(data_bias, data_bias$Rating == 'Agriculture Forestry and Fishing')
summary(in2$Rating)

r3 <- subset(data_bias, data_bias$Rating == 'Arts and Recreation Services')
summary(in3$Rating)

r4 <- subset(data_bias, data_bias$Rating == 'Construction')
summary(in4$Rating)

r5 <- subset(data_bias, data_bias$Rating == 'Education and Training')
summary(in5$Rating)

r6 <- subset(data_bias, data_bias$Rating == 'Electricity Gas Water and Waste Services')
summary(in6$Rating)

r7 <- subset(data_bias, data_bias$Rating == 'Financial and Insurance Services')
summary(in7$Rating)

r8 <- subset(data_bias, data_bias$Rating == 'Healthcare and Social Assistance')
summary(in8$Rating)

r9 <- subset(data_bias, data_bias$Rating == 'Information Media and Telecommunications')
summary(in9$Rating)

r10 <- subset(data_bias, data_bias$Rating == 'Manufacturing')
summary(in10$Rating)

r11 <- subset(data_bias, data_bias$Rating == 'Mining')
summary(in11$Rating)

r12 <- subset(data_bias, data_bias$Rating == 'Professional Scientific and Technical Services')
summary(in12$Rating)

r13 <- subset(data_bias, data_bias$Rating == 'Public Administration and Safety')
summary(in13$Rating)

r14 <- subset(data_bias, data_bias$Rating == 'Rental Hiring and Real Estate Services')
summary(in14$Rating)

r15 <- subset(data_bias, data_bias$Rating == 'Retail Trade')
summary(in15$Rating)

r16 <- subset(data_bias, data_bias$Rating == 'Transport Postal and Warehousing')
summary(in16$Rating)

r17 <- subset(data_bias, data_bias$Rating == 'Wholesale Trade')
summary(in17$Rating)

```




```{r}
###------ calculating pearsons correlation of bias and ratio  -----####

#cor(data_bias$Ratio, data_bias$Ratio, method = c("pearson"))

cor.test(data_bias$Ratio, data_bias$mean_bias, method=c("pearson"))

```


```{r}
ds <- read_csv("df_salary2.csv")
```

```{r}
dad <- read_csv("dataset_final_admin.csv")


```

```{r}

dic <- read_csv("gender_bias_dict_admin.csv")

newdata6 <- dic[ which(dic$Bias > '-1000'), ]
length(newdata6$Bias)

dic <- distinct(newdata6)
length(dic$Word)

```



```{r}

sal1 <- subset(ds, ds$Industry == 'Accommodation and Food Services')
summary(sal1$salary_mean)


sal2 <- subset(ds, ds$Industry == 'Agriculture Forestry and Fishing')
summary(sal2$salary_mean)



sal22 <- subset(ds, ds$Industry == '')
summary(sal2$salary_mean)


sal3 <- subset(ds, ds$Industry == 'Arts and Recreation Services')
summary(sal2$salary_mean)


sal4 <- subset(ds, ds$Industry == 'Construction')
summary(sal4$salary_mean)


sal5 <- subset(ds, ds$Industry == 'Education and Training')
summary(sal5$salary_mean)


sal6 <- subset(ds, ds$Industry == 'Electricity Gas Water and Waste Services')
summary(sal6$salary_mean)

 
sal7 <- subset(ds, ds$Industry == 'Financial and Insurance Services')
summary(sal7$salary_mean)


sal8 <- subset(ds, ds$Industry == 'Healthcare and Social Assistance')
summary(sal8$salary_mean)


sal9 <- subset(ds, ds$Industry == 'Information Media and Telecommunications')
summary(sal9$salary_mean)


sal10 <- subset(ds, ds$Industry == 'Manufacturing')
summary(sal10$salary_mean)


sal11 <- subset(ds, ds$Industry == 'Mining')
summary(sal11$salary_mean)


sal12 <- subset(ds, ds$Industry == 'Professional Scientific and Technical Services')
summary(sal12$salary_mean)


sal13 <- subset(ds, ds$Industry == 'Public Administration and Safety')
summary(sal13$salary_mean)


sal14 <- subset(ds, ds$Industry == 'Rental Hiring and Real Estate Services')
summary(sal14$salary_mean)


sal15 <- subset(ds, ds$Industry == 'Retail Trade')
summary(sal15$salary_mean)
 

sal16 <- subset(ds, ds$Industry == 'Transport Postal and Warehousing')
summary(sal16$salary_mean)


sal17 <- subset(ds, ds$Industry == 'Wholesale Trade')
summary(sal17$salary_mean)


```

```{r}

r1 <- subset(data_bias, data_bias$Rating == 'Accommodation and Food Services')
summary(in1$Rating)

r2 <- subset(data_bias, data_bias$Rating == 'Agriculture Forestry and Fishing')
summary(in2$Rating)

r3 <- subset(data_bias, data_bias$Rating == 'Arts and Recreation Services')
summary(in3$Rating)

r4 <- subset(data_bias, data_bias$Rating == 'Construction')
summary(in4$Rating)

r5 <- subset(data_bias, data_bias$Rating == 'Education and Training')
summary(in5$Rating)

r6 <- subset(data_bias, data_bias$Rating == 'Electricity Gas Water and Waste Services')
summary(in6$Rating)

r7 <- subset(data_bias, data_bias$Rating == 'Financial and Insurance Services')
summary(in7$Rating)

r8 <- subset(data_bias, data_bias$Rating == 'Healthcare and Social Assistance')
summary(in8$Rating)

r9 <- subset(data_bias, data_bias$Rating == 'Information Media and Telecommunications')
summary(in9$Rating)

r10 <- subset(data_bias, data_bias$Rating == 'Manufacturing')
summary(in10$Rating)

r11 <- subset(data_bias, data_bias$Rating == 'Mining')
summary(in11$Rating)

r12 <- subset(data_bias, data_bias$Rating == 'Professional Scientific and Technical Services')
summary(in12$Rating)

r13 <- subset(data_bias, data_bias$Rating == 'Public Administration and Safety')
summary(in13$Rating)

r14 <- subset(data_bias, data_bias$Rating == 'Rental Hiring and Real Estate Services')
summary(in14$Rating)

r15 <- subset(data_bias, data_bias$Rating == 'Retail Trade')
summary(in15$Rating)

r16 <- subset(data_bias, data_bias$Rating == 'Transport Postal and Warehousing')
summary(in16$Rating)

r17 <- subset(data_bias, data_bias$Rating == 'Wholesale Trade')
summary(in17$Rating)
```



### ----- Plots - Gender Bias Per Industry (All) ----- ### 
```{r}

cols_ratio <- c("Construction" = "#020873", "Mining" = "#180b77", "Transport Postal and Warehousing" = "#260e7c", "Electricity Gas Water and Waste Services" = "#311180", "Manufacturing" = "#3c1485", "Wholesale Trade" = "#451789", "Agriculture Forestry and Fishing" = "#4e1b8d",  "Information Media and Telecommunications" = "#571f92", "Professional Scientific and Technical Services" = "#602296", "Rental Hiring and Real Estate Services" = "#68269a", "Public Administration and Safety" = "#712a9f", "Financial and Insurance Services" = "#792ea3", "Arts and Recreation Services" = "#8232a7",  "Administrative and Support Services" = "#8a36ab", "Accommodation and Food Services" = "#923aaf", "Retail Trade" = "#9a3eb4", "Education and Training" = "#a343b8", "Healthcare and Social Assistance" = "#ab47bc")

ggplot(data_bias, aes(x= reorder(Industry, -man_woman), y=man_woman, label=man_woman, fill = Industry)) +
  geom_bar(stat='summary', width=.5)  +
  scale_x_discrete(position = "top")+
  coord_flip()+
  labs(title="Mean Gender Bias per Industry", y = "Gender Bias", x = "Industry") +
  scale_fill_manual(values = cols_ratio)

```



```{r}
data_bias %>% group_by(Industry) %>% 
  ggplot(aes(mean_bias,salary_mean2020, color=Industry)) + 
  geom_point()+
  geom_smooth(method = "lm")+
  geom_text(aes(label=Industry),hjust=0, vjust=0)+ 
  labs(title="Mean Gender Bias vs. Mean Salary per Industry", y = "Mean Salary", x = "Gender Bias") +
  scale_colour_manual(values = cols_ratio)

```

```{r}
cor.test(data_bias$salary_mean2020, data_bias$mean_bias, method=c("pearson"))

```

```{r}
data_bias %>% group_by(Industry) %>% 
  ggplot(aes(Ratio,salary_mean2020, color=Industry)) + 
  geom_point()+
  geom_smooth(method = "lm")+
  geom_text(aes(label=Industry),hjust=0, vjust=0)+ 
  labs(title="Gender Ratio vs. Mean Salary per Industry", y = "Mean Salary", x = "Gender Ratio") +
  scale_colour_manual(values = cols_ratio)

```

```{r}
cor.test(data_bias$salary_mean2020, data_bias$Ratio, method=c("pearson"))
```


```{r}
data_bias %>% group_by(Industry) %>% 
  ggplot(aes(gpg,salary_mean2020, color=Industry)) + 
  geom_point()+
  geom_smooth(method = "lm")+
  geom_text(aes(label=Industry),hjust=0, vjust=0)+ 
  labs(title="Mean Gender Bias vs. Mean Salary 2020 per Industry", y = "Mean Salary", x = "Gender Bias") +
  scale_colour_manual(values = cols_ratio)

```
```{r}

cor.test(data_bias$salary_mean2020, data_bias$mean_bias, method=c("pearson"))

```


### ---- Plotting bias against gender ratio in industry --- ###
```{r}
#ggthemr_reset()

cols_ratio <- c("Construction" = "#020873", "Mining" = "#180b77", "Transport Postal and Warehousing" = "#260e7c", "Electricity Gas Water and Waste Services" = "#311180", "Manufacturing" = "#3c1485", "Wholesale Trade" = "#451789", "Agriculture Forestry and Fishing" = "#4e1b8d",  "Information Media and Telecommunications" = "#571f92", "Professional Scientific and Technical Services" = "#602296", "Rental Hiring and Real Estate Services" = "#68269a", "Public Administration and Safety" = "#712a9f", "Financial and Insurance Services" = "#792ea3", "Arts and Recreation Services" = "#8232a7", "Administrative and Support Services" = "#8a36ab", "Accommodation and Food Services" = "#923aaf", "Retail Trade" = "#9a3eb4", "Education and Training" = "#a343b8", "Healthcare and Social Assistance" = "#ab47bc")


data_bias %>% group_by(Industry) %>% 
  ggplot(aes(mean_bias,Ratio, color=Industry)) + 
  geom_point()+
  geom_smooth(method = "lm")+
  geom_text(aes(label=Industry),hjust=0, vjust=0)+ 
  labs(title="Mean Gender Bias vs. Gender Ratio per Industry", y = "Gender Ratio", x = "Gender Bias") +
  scale_colour_manual(values = cols_ratio)
```


```{r}

data_bias %>% group_by(Industry) %>% 
  ggplot(aes(salary_mean,Ratio, color=Industry)) + 
  geom_point(stat='summary')+
  geom_smooth(method = "lm")+
  geom_text(aes(label=Industry),hjust=0, vjust=0)+ 
  labs(title="Indeed Data: Gender Bias / Gender Ratio - Plot", y = "Gender Bias", x = "Industry") +
  scale_colour_manual(values = cols_ratio)
```


```{r}
data_bias %>% group_by(Industry) %>% 
  ggplot(aes(mean_bias,rating_average, color=Industry)) + 
  geom_point()+
  geom_smooth(method = "lm")+
  geom_text(aes(label=Industry),hjust=0, vjust=0)+ 
  labs(title="Plot - Gender Bias vs. Average Rating per Industry", y = "Average Rating", x = "Gender Bias")+
  scale_colour_manual(values = cols_ratio)
```

```{r}
cor.test(data_bias$rating_average, data_bias$mean_bias, method=c("pearson"))

```
```{r}
lm_rat <- lm(rating_average ~ mean_bias, data_bias)
summary(lm_rat)
```



```{r}
cor.test(data_bias$Ratio, data_bias$rating_average, method=c("pearson"))

```
```{r}
lm_rat_ratio <- lm(rating_average ~ Ratio, data_bias)
summary(lm_rat_ratio)
```


```{r}
data_bias %>% group_by(Industry) %>% 
  ggplot(aes(Ratio,rating_average, color=Industry)) + 
  geom_point()+
  geom_smooth(method = "lm")+
  geom_text(aes(label=Industry),hjust=0, vjust=0)+ 
  labs(title="Gender Bias / Average Rating - Plot", y = "Average Rating", x = "Gender Ratio")+
  scale_colour_manual(values = cols_ratio)
```

```{r}
# call in dataset where occupations are not duplicated 
data_occ <- read.csv("dataset_final_google_occupations.csv")

#plot 
gg_occ <- ggplot(data_occ, aes(x= reorder(Occupation, -man_woman), y=man_woman, label=man_woman, fill=Industry)) +
  geom_bar(stat='summary', width=.5)  +
  scale_x_discrete(position = "top")+
  coord_flip()+
scale_fill_manual(values = cols_ratio) + 
  labs(title="Gender Bias per Occupation", y = "Gender Bias", x = "Occupation")


gg_occ + theme(axis.text = element_text(size = 4))     
```

```{r}

occ_order <- data_bias %>% 
  group_by(Occupation) %>% 
  summarise(mean(man_woman))

print(occ_order)

write.csv(occ_order,"occ_order.csv") 
```

Top 15 of most biased occupations 
Female: 
Midwife	-0.016898498
Nurse	-0.008417315
Secondary School Teacher	-0.007815566
Social Worker	-0.007767759
Registered Nurse	-0.007643099
Lecturer	-0.007608068
Aged Care	-0.007421723
Educational Clerk	-0.007049199
Librarian	-0.006967794
Resident Medical Officer	-0.006844653
Personal Care Worker	-0.005785741
School Principal	-0.00572237
Carer	-0.005361562
Museum	-0.004937772
Library Worker	-0.004894296

Male: 
Restaurant Manager	0.009366877
Joiner	0.009399503
Sport	0.009405911
Concreter	0.009409644
Metal Fitter	0.009475927
Kitchen Hand	0.009868891
Cabinetmaker	0.009915721
Plumbing Labourer	0.010021809
Plumber	0.010044995
Fast Food Worker	0.010376835
Tiler	0.010615906
Welder	0.010827589
Carpenter	0.012217005
Personal Trainer	0.01254382
Bricklayer	0.013534784



### ---- Top 10 of each most biased job description - their occupations --- ##
```{r}
data_top10 <- read_csv("dataset_final_google_occupation_top10.csv")


ggplot(data_top10, aes(x= reorder(Occupation, -man_woman), y=man_woman, label=man_woman, fill=Industry)) +
  geom_bar(stat='summary', width=.5)  +
  scale_x_discrete(position = "top")+
  coord_flip()+
  scale_fill_manual(values = cols_ratio) + 
  labs(title="Top 10 Male and Female Biased Occupations", y = "Gender Bias", x = "Occupation")


```

```{r}
install.packages('ggthemes')
library("ggthemes")

ggplot(data_top10, aes(x= reorder(Occupation, -man_woman), y=man_woman, label=man_woman, fill=Occupation)) +
  geom_bar(stat='summary', width=.5)  +
  scale_x_discrete(position = "top")+
  coord_flip() + 
  theme_pander() +
  scale_fill_pander()

```



### --- Top 5 highest ratio plot --- ### (compare with above)

Stats on the top 5 most Ratio men/women industries: 
Male: Overall proportion across all industries = 57.65%
1. Construction (87.3%)
2. Mining (83%)
3. Transport, postal and warehousing (79.8%)
4. Electricity, gas, water and waste services (76.2%)
5. Manufacturing (72.5%)

Female: Overall proportion across all industries = 42.35%
1. Health care and social assistance (77.9%)
2. Education and training (71.6%)
3. Retail trade (55.2%)
4. Accommodation and food services (54.5%)
5. Administrative and support services (52.9%)


Most biased according to data (mean bias per industry): 
Male: 
1. Accommodation and Food Services
2. Manufacturing
3. Wholesale Trade
4. Construction
5. Transport Postal and Warehousing

Female: 
1. Healthcare and Social Assistance (only female)
2. Education and Training (only female)
3. Public Administration and Safety
4. Financial and Insurance Services
5. Professional Scientific and Technical Services !!! << this is interesting in terms of STEM, maybe we are seeing a change here! 



```{r}



```




### --- Top 5 most biased of each industry (mean_bias)--- ####
```{r}


```


### --- Plots of occupations within subsets of Industries, see how they compare to the mean --- #### 
```{r}
#ggthemr_reset()

library("ggthemes")


ggplot(in1, aes(x= reorder(Occupation, -man_woman), y=man_woman, label=man_woman, fill = Occupation)) +
  geom_bar(stat='summary', width=.5)  +
  scale_x_discrete(position = "top")+
  coord_flip()+
  xlim(-0.5, 0.5) +
  labs(title="Occupation by Gender Bias - Accommodation and Food Services", y = "Gender Bias", x = "Occupation") + 
  theme_pander() +
  scale_fill_pander()

```
```{r}

ggplot(in2, aes(x= reorder(Occupation, -man_woman), y=man_woman, label=man_woman, fill = Occupation)) +
  geom_bar(stat='summary', width=.5)  +
  scale_x_discrete(position = "top")+
  coord_flip()+
  labs(title="Occupation by Gender Bias - Agriculture Forestry and Fishing", y = "Gender Bias", x = "Occupation") + 
  theme_pander() +
  scale_fill_pander()


```

```{r}

ggplot(in3, aes(x= reorder(Occupation, -man_woman), y=man_woman, label=man_woman, fill = Occupation)) +
  geom_bar(stat='summary', width=.5)  +
  scale_x_discrete(position = "top")+
  coord_flip()+
  labs(title="Occupation by Gender Bias - Arts and Recreation Services", y = "Gender Bias", x = "Occupation") + 
  theme_pander() +
  scale_fill_pander()

```

```{r}

ggplot(in4, aes(x= reorder(Occupation, -man_woman), y=man_woman, label=man_woman, fill = Occupation)) +
  geom_bar(stat='summary', width=.5)  +
  scale_x_discrete(position = "top")+
  coord_flip()+
  labs(title="Occupation by Gender Bias - Construction", y = "Gender Bias", x = "Occupation")+ 
  theme_pander() +
  scale_fill_pander()

```

```{r}
ggplot(in22, aes(x= reorder(Occupation, -man_woman), y=man_woman, label=man_woman, fill = Occupation)) +
  geom_bar(stat='summary', width=.5)  +
  scale_x_discrete(position = "top")+
  coord_flip()+
  labs(title="Occupation by Gender Bias - Administrative and Support Services", y = "Gender Bias", x = "Occupation")+ 
  theme_pander() +
  scale_fill_pander()
```


```{r}

ggplot(in5, aes(x= reorder(Occupation, -man_woman), y=man_woman, label=man_woman, fill = Occupation)) +
  geom_bar(stat='summary', width=.5)  +
  scale_x_discrete(position = "top")+
  coord_flip()+
  labs(title="Occupation by Gender Bias - Education and Training", y = "Gender Bias", x = "Occupation") + 
  theme_pander() +
  scale_fill_pander()

```

```{r}

ggplot(in6, aes(x= reorder(Occupation, -man_woman), y=man_woman, label=man_woman, fill = Occupation)) +
  geom_bar(stat='summary', width=.5)  +
  scale_x_discrete(position = "top")+
  coord_flip()+
  labs(title="Occupation by Gender Bias - Electricity Gas Water and Waste Services", y = "Gender Bias", x = "Occupation")  + 
  theme_pander() +
  scale_fill_pander()



```

```{r}

ggplot(in7, aes(x= reorder(Occupation, -man_woman), y=man_woman, label=man_woman, fill = Occupation)) +
  geom_bar(stat='summary', width=.5)  +
  scale_x_discrete(position = "top")+
  coord_flip()+
  labs(title="Occupation by Gender Bias - Financial and Insurance Services", y = "Gender Bias", x = "Occupation")  + 
  theme_pander() +
  scale_fill_pander()


```

```{r}

ggplot(in8, aes(x= reorder(Occupation, -man_woman), y=man_woman, label=man_woman, fill = Occupation)) +
  geom_bar(stat='summary', width=.5)  +
  scale_x_discrete(position = "top")+
  coord_flip()+
  labs(title="Occupation by Gender Bias - Healthcare and Social Assistance", y = "Gender Bias", x = "Occupation") + 
  theme_pander() +
  scale_fill_pander()



```

```{r}

ggplot(in9, aes(x= reorder(Occupation, -man_woman), y=man_woman, label=man_woman, fill = Occupation)) +
  geom_bar(stat='summary', width=.5)  +
  scale_x_discrete(position = "top")+
  coord_flip()+
  labs(title="Occupation by Gender Bias - Information Media and Telecommunications", y = "Gender Bias", x = "Occupation") + 
  theme_pander() +
  scale_fill_pander()


```

```{r}

ggplot(in10, aes(x= reorder(Occupation, -man_woman), y=man_woman, label=man_woman, fill = Occupation)) +
  geom_bar(stat='summary', width=.5)  +
  scale_x_discrete(position = "top")+
  coord_flip()+
  labs(title="Occupation by Gender Bias - Manufacturing", y = "Gender Bias", x = "Occupation") + 
  theme_pander() +
  scale_fill_pander()


```

```{r}

ggplot(in11, aes(x= reorder(Occupation, -man_woman), y=man_woman, label=man_woman, fill = Occupation)) +
  geom_bar(stat='summary', width=.5)  +
  scale_x_discrete(position = "top")+
  coord_flip()+
  labs(title="Occupation by Gender Bias - Mining", y = "Gender Bias", x = "Occupation") + 
  theme_pander() +
  scale_fill_pander()


```

```{r}

ggplot(in12, aes(x= reorder(Occupation, -man_woman), y=man_woman, label=man_woman, fill = Occupation)) +
  geom_bar(stat='summary', width=.5)  +
  scale_x_discrete(position = "top")+
  coord_flip()+
  labs(title="Occupation by Gender Bias - Professional Scientific and Technical Services", y = "Gender Bias", x = "Occupation") + 
  theme_pander() +
  scale_fill_pander()


```

```{r}

ggplot(in13, aes(x= reorder(Occupation, -man_woman), y=man_woman, label=man_woman, fill = Occupation)) +
  geom_bar(stat='summary', width=.5)  +
  scale_x_discrete(position = "top")+
  coord_flip()+
  labs(title="Occupation by Gender Bias - Public Administration and Safety", y = "Gender Bias", x = "Occupation") + 
  theme_pander() +
  scale_fill_pander()

```

```{r}

ggplot(in14, aes(x= reorder(Occupation, -man_woman), y=man_woman, label=man_woman, fill = Occupation)) +
  geom_bar(stat='summary', width=.5)  +
  scale_x_discrete(position = "top")+
  coord_flip()+
  labs(title="Occupation by Gender Bias - Rental Hiring and Real Estate Services", y = "Gender Bias", x = "Occupation") + 
  theme_pander() +
  scale_fill_pander()


```

```{r}

ggplot(in15, aes(x= reorder(Occupation, -man_woman), y=man_woman, label=man_woman, fill = Occupation)) +
  geom_bar(stat='summary', width=.5)  +
  scale_x_discrete(position = "top")+
  coord_flip()+
  labs(title="Occupation by Gender Bias - Retail Trade", y = "Gender Bias", x = "Occupation") + 
  theme_pander() +
  scale_fill_pander()

```

```{r}

ggplot(in16, aes(x= reorder(Occupation, -man_woman), y=man_woman, label=man_woman, fill = Occupation)) +
  geom_bar(stat='summary', width=.5)  +
  scale_x_discrete(position = "top")+
  coord_flip()+
  labs(title="Occupation by Gender Bias - Transport Postal and Warehousing", y = "Gender Bias", x = "Occupation") + 
  theme_pander() +
  scale_fill_pander()


```

```{r}

ggplot(in17, aes(x= reorder(Occupation, -man_woman), y=man_woman, label=man_woman, fill = Occupation)) +
  geom_bar(stat='summary', width=.5)  +
  scale_x_discrete(position = "top")+
  coord_flip()+
  labs(title="Occupation by Gender Bias - Wholesale Trade", y = "Gender Bias", x = "Occupation")  + 
  theme_pander() +
  scale_fill_pander()


```


### --- Plotting GPG per Industry against bias, ratio etc ---- ####
```{r}
data_bias %>% group_by(Industry) %>% 
  ggplot(aes(mean_bias,gpg, color=Industry)) + 
  geom_point()+
  geom_smooth(method = "lm")+
  geom_text(aes(label=Industry),hjust=0, vjust=0)+ 
  labs(title="Average Gender Bias vs. GPG per Industry", y = "GPG", x = "Average Gender Bias")+
  scale_colour_manual(values = cols_ratio)


```
```{r}

cor.test(data_bias$gpg, data_bias$mean_bias, method=c("pearson"))

```


```{r}

data_bias %>% group_by(Industry) %>% 
  ggplot(aes(Ratio,gpg, color=Industry)) + 
  geom_point()+
  geom_smooth(method = "lm")+
  geom_text(aes(label=Industry),hjust=0, vjust=0)+ 
  labs(title="Gender Ratio vs. GPG per Industry", y = "GPG", x = "Ratio")+
  scale_colour_manual(values = cols_ratio)

```
```{r}

cor.test(data_bias$gpg, data_bias$Ratio, method=c("pearson"))

```

```{r}
## extracting which rows have the most biased words 

ws <- data_bias[grep("'brilliance'", data_bias$clean), ]

ws <- subset(ws, select=c("Job Title", "Occupation", "Industry", "Job Description", "clean"))

ws %>% 
  group_by(Industry) %>% 
  print(ws)

write_csv(ws,"brilliance.csv")  
```

```{r}
#df %>% group_by("Amount") %>% slice(which.min(x))

data_bias %>%
  group_by("Occupation") %>%
  data_bias[which(data_bias$clean == "hero"), ] 


```


```{r}

frequency_dataframe = new_df %>% count(word) %>% arrange(desc(n))


```


```{r}

```


```






